<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PKO Perspektywy Sektorów</title>
  <link rel="stylesheet" href="dashboard.css" />
</head>
<body>
  <div class="page">
    <header class="top-bar">
      <div class="brand">
        <div class="logo" aria-label="Znak PKO">
          <svg viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <rect x="18" y="20" width="12" height="26" rx="5" fill="#dce8ff" opacity="0.9"/>
            <rect x="30" y="16" width="12" height="30" rx="6" fill="#a8c4ff"/>
            <rect x="42" y="22" width="10" height="24" rx="5" fill="#6b9dff"/>
            <circle cx="32" cy="12" r="4.2" fill="#e8433f"/>
          </svg>
        </div>
        <div class="titles">
          <span class="eyebrow">PKO Bank Polski</span>
          <h1>Panel perspektyw sektorów</h1>
        </div>
      </div>

      <div class="actions">
        <div class="pill segment" id="segment-control">
          <label>Klasyfikacja</label>
          <button data-segment="all" class="active">Wszystkie</button>
          <button data-segment="developing">Rozwojowe</button>
          <button data-segment="core">Kluczowe</button>
          <button data-segment="watchlist">Na obserwacji</button>
        </div>

        <div class="pill year-pill">
          <label for="year">Rok</label>
          <input id="year" type="range" min="0" max="4" value="4" step="1" aria-label="Wybór roku">
          <div class="year-readout">
            <span id="year-value">—</span>
            <span id="forecast-flag" class="forecast-flag" aria-live="polite">Prognoza</span>
          </div>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT MAIN -->
      <section class="panel">
        <div class="panel-row">
          <div>
            <h2>Macierz PKD w czasie</h2>
          </div>
        </div>

        <div class="toggle" id="matrix-toggle">
          <button data-mode="heatmap" class="active">Mapa cieplna</button>
          <button data-mode="growth-profit">Macierz PKD: wzrost vs zysk</button>
          <button data-mode="ikb">Ranking IKB</button>
        </div>

        <div class="chart-wrap rel">
          <canvas id="matrix" class="heatmap"></canvas>
          <canvas id="gp-chart" class="heatmap is-hidden"></canvas>
          <canvas id="ikb-chart" class="heatmap is-hidden"></canvas>
          <div id="matrix-tooltip" class="tooltip" role="tooltip"></div>
        </div>

        <p class="note">
          Kolejność odzwierciedla bieżące perspektywy;
          kliknij dowolną komórkę/punkt/linię, aby przypiąć sektor w sekcji szczegółowej.
        </p>
      </section>

      <!-- RIGHT DETAIL -->
      <section class="panel" id="detail">
        <div class="detail-header">
          <div>
            <h2>Szczegóły sektora</h2>
            <p class="sub" id="detail-name">Wybierz sektor, aby zobaczyć ścieżkę</p>
          </div>

          <label class="picker" for="sector-picker">
            <span>Wybierz sektor</span>
            <select id="sector-picker" aria-label="Wybór sektora"></select>
          </label>
        </div>

        <div class="tag" id="detail-tag">—</div>

        <div class="mini-grid">
          <div>
            <small>Wynik łączny</small>
            <canvas class="spark" id="spark-score"></canvas>
          </div>
          <div>
            <small>Ryzyko (proxy upadłości)</small>
            <canvas class="spark" id="spark-risk"></canvas>
          </div>
          <div>
            <small>Wskaźnik zadłużenia</small>
            <canvas class="spark" id="spark-debt"></canvas>
          </div>
        </div>

        <div class="mini-grid">
          <div class="chip" id="chip-growth">Wzrost: —</div>
          <div class="chip" id="chip-risk">Ryzyko: —</div>
          <div class="chip" id="chip-export">Udział eksportu: —</div>
        </div>

      </section>
    </div>

    <!-- RANKING -->
    <section class="panel">
      <div class="panel-row">
        <div>
      <h2>Ranking i uzasadnienie</h2>
      <p class="sub">Kliknij wiersz, aby przypiąć szczegóły • Wyniki dostosowują się do wybranego roku (w tym prognozy do 2027)</p>
    </div>
    <div class="legend">
      <span>Wagi segmentów: wzrost (40%), dźwignia (30%), stres upadłościowy (30%)</span>
    </div>
  </div>

  <table class="table" id="table">
    <thead>
      <tr>
        <th>Miejsce</th>
        <th>Sektor</th>
        <th>Segment</th>
        <th>Wynik</th>
        <th>Wzrost</th>
        <th>Ryzyko</th>
        <th>Zadłużenie</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- FORECAST DRIVERS -->
<section class="panel">
  <h2>Determinanty prognozy</h2>
  <p class="sub">Dane wejściowe użyte do przedłużenia horyzontu do 2027 (pkd_to_variables.json + dane PKO)</p>
  <div class="legend" id="drivers-list"></div>
  <div class="metric-grid" id="metric-grid"></div>
  <p class="note">
    Prognozy łączą historyczne przychody (GS), kapitał obrotowy (NWC), upadłości KRZ,
    udział eksportu oraz makro/commodity powiązane z PKD.
    Rozszerzaj lub redukuj zestaw zmiennych w pkd_to_variables.json.
  </p>
</section>

<!-- PORTFOLIO HEALTH (MOVED) -->
<section class="panel" style="margin-top:18px;">
  <h2>Zdrowie portfela</h2>
  <p class="sub">Odporność, ryzyko i momentum w grupach PKD</p>

  <div class="kpis" id="kpi-list"></div>

  <div class="chart-wrap">
    <canvas id="scatter" aria-label="Wykres rozrzutu wzrost vs ryzyko"></canvas>

    <div class="legend">
      <span><span class="dot is-dev"></span>Rozwojowe</span>
      <span><span class="dot is-core"></span>Kluczowe</span>
      <span><span class="dot is-watch"></span>Na obserwacji</span>
      <span><span class="dot is-lowrisk"></span>Niższe ryzyko ↘︎</span>
    </div>
  </div>

  <div class="method">
    <strong>Dlaczego ten widok?</strong>
    Korzystamy z podejścia ryzyka kredytowego PKO: sektory dzielimy na
    <em>Rozwojowe</em> (szybki wzrost, kontrolowana dźwignia),
    <em>Kluczowe</em> (strategiczne, stabilne fundamenty) oraz
    <em>Na obserwacji</em> (podwyższone upadłości lub zadłużenie). Wynik miesza momentum wzrostu,
    wskaźnik zadłużenia, udział eksportu i sygnały upadłości.
  </div>
</section>

    <!-- PREBUILT PKD VISUALS (IFRAMES) -->
    <section class="panel" style="margin-top:18px;">
        <header class="panel-head">
            <div>
            <p class="eyebrow">Pogłębione analizy</p>
            <h2>Gotowe wizualizacje PKD</h2>
            </div>
        </header>

        <div class="plot-grid">
            <div class="plot-card">
            <h3>Średnie wskaźniki wg roku</h3>
            <iframe src="plots/avg_ratios_by_year.html" title="Średnie wskaźniki" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>Ewolucja grup PKD</h3>
            <iframe src="plots/pkd_group_evolution_heatmap.html" title="Ewolucja PKD" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>Wzrost vs zysk (animacja)</h3>
            <iframe src="plots/pkd_growth_profit_matrix_animated.html" title="Wzrost vs zysk" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>Trajektorie macierzy PKD</h3>
            <iframe src="plots/pkd_matrix_trajectories.html" title="Trajektorie PKD" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>Ranking IKB (animacja)</h3>
            <iframe src="plots/pkd_ikb_rank_animated.html" title="Ranking IKB" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>Trendy IKB (animacja)</h3>
            <iframe src="plots/pkd_ikb_trends_animated.html" title="Trendy IKB" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>Ranking FPI (animacja)</h3>
            <iframe src="plots/pkd_fpi_ranking_animated.html" title="Ranking FPI" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>FPI trends</h3>
            <iframe src="plots/pkd_fpi_trends.html" title="Trendy FPI" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>PKD 46.4 – IKB vs FPI</h3>
            <iframe src="plots/pkd_46.4_ikb_vs_fpi.html" title="46.4 IKB vs FPI" loading="lazy"></iframe>
            </div>

            <div class="plot-card">
            <h3>PKD 46.4 filary (animacja)</h3>
            <iframe src="plots/pkd_46.4_pillars_animated.html" title="Filary 46.4" loading="lazy"></iframe>
            </div>
        </div>
        </section>
    </div>

  <script src="dashboard.js"></script>
</body>
</html>
